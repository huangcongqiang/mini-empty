<!--pages/admin/products/products.wxml-->
<view class="container">
  <!-- 分类筛选 -->
  <scroll-view class="category-bar" scroll-x>
    <view class="cat-item {{!selectedCategory ? 'active' : ''}}" bindtap="selectCategory" data-id="">全部</view>
    <view class="cat-item {{selectedCategory === item.id ? 'active' : ''}}" 
      wx:for="{{categories}}" wx:key="id"
      bindtap="selectCategory" data-id="{{item.id}}">
      {{item.icon}} {{item.name}}
    </view>
  </scroll-view>

  <!-- 加载中 -->
  <view class="loading" wx:if="{{loading}}">
    <c-icon name="loading" size="60rpx"></c-icon>
    <text>加载中...</text>
  </view>

  <!-- 商品列表 -->
  <view class="product-list" wx:if="{{!loading}}">
    <view class="product-card" wx:for="{{products}}" wx:key="id">
      <image class="product-image" src="{{item._fullImageUrl}}" mode="aspectFill"></image>
      <view class="product-info">
        <view class="product-name">{{item.name}}</view>
        <view class="product-category">{{item.category_name}}</view>
        <view class="product-status {{item.is_active ? 'active' : 'inactive'}}">
          {{item.is_active ? '已上架' : '已下架'}}
        </view>
      </view>
      <view class="product-actions">
        <button class="action-btn edit" bindtap="editProduct" data-product="{{item}}" aria-label="编辑商品">
          <image class="action-icon" src="/assets/edit.svg" mode="aspectFit"></image>
        </button>
        <button class="action-btn delete" bindtap="deleteProduct" data-id="{{item.id}}" aria-label="删除商品">
          <image class="action-icon" src="/assets/delete.svg" mode="aspectFit"></image>
        </button>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty" wx:if="{{products.length === 0}}">
      <c-icon name="package" size="120rpx" customStyle="opacity:0.3;"></c-icon>
      <text>暂无商品</text>
      <text class="empty-hint">点击右下角按钮添加商品</text>
    </view>
  </view>

  <!-- 添加按钮 -->
  <view class="add-btn" bindtap="showAddModal">
    <c-icon name="plus" size="48rpx"></c-icon>
  </view>
</view>

<!-- 添加/编辑弹窗 -->
<view class="modal" wx:if="{{showModal}}" bindtap="hideModal">
  <view class="modal-content" catchtap="">
    <view class="modal-header">
      <text class="modal-title">{{editingProduct ? '编辑商品' : '添加商品'}}</text>
      <view class="modal-close" bindtap="hideModal">×</view>
    </view>
    <scroll-view class="modal-body" scroll-y>
      <!-- 商品图片 -->
      <view class="form-item">
        <text class="form-label">商品图片 *</text>
        <view class="image-picker" bindtap="chooseImage">
          <image wx:if="{{formData.imagePath}}" class="preview-image" src="{{formData.imagePath}}" mode="aspectFill"></image>
          <view wx:else class="picker-placeholder">
            <c-icon name="camera" size="60rpx"></c-icon>
            <text>选择图片</text>
          </view>
        </view>
      </view>
      <!-- 商品名称 -->
      <view class="form-item">
        <text class="form-label">商品名称 *</text>
        <input class="form-input" placeholder="请输入商品名称" value="{{formData.name}}" bindinput="onInputName" />
      </view>
      <!-- 分类 -->
      <view class="form-item">
        <text class="form-label">商品分类 *</text>
        <picker mode="selector" range="{{categories}}" range-key="name" value="{{formData.categoryIndex}}" bindchange="onCategoryChange">
          <view class="form-picker">
            <text>{{categories[formData.categoryIndex].icon}} {{categories[formData.categoryIndex].name}}</text>
            <view class="picker-arrow"></view>
          </view>
        </picker>
      </view>
      <!-- 商品描述 -->
      <view class="form-item">
        <text class="form-label">商品描述</text>
        <textarea class="form-textarea" placeholder="请输入商品描述（可选）" value="{{formData.description}}" bindinput="onInputDesc" />
      </view>
      <!-- 商品链接 -->
      <view class="form-item">
        <text class="form-label">商品链接</text>
        <input class="form-input" placeholder="购买链接（可选）" value="{{formData.link}}" bindinput="onInputLink" />
      </view>
    </scroll-view>
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="hideModal">取消</button>
      <button class="btn-confirm" bindtap="saveProduct" loading="{{saving}}">保存</button>
    </view>
  </view>
</view>

